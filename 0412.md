# 0412

## 3. Storage 추가 (Mount; Block Storage 다루기 - AWS EBS)

* 마운트(mount)는 컴퓨터 과학에서 저장 장치에 접근할 수 있는 경로를 디렉터리 구조에 편입시키는 작업입니다. 
* 좁은 의미로는 유닉스 계열의 운영 체제에서의 mount 명령어 또는 그 명령어를 사용하는 것입니다. 
* mount 명령어를 사용하면 저장 장치의 접근 경로를 원하는 위치에 생성할 수 있습니다. 
* 마운트를 이용하면 분산 파일 시스템으로 확장하기가 용이합니다. 
* 사용자는 마운트된 미디어의 파일들에만 접근이 가능합니다.

```
# lsblk
# mkfs -t xfs /dev/sdb
# mkdir /data
# mount /dev/sdb /data
# file -s /dev/sdb
# cp /etc/fstab /etc/fstab.orig
# blkid
# vi /etc/fstab
UUID=aebf131c-6957-451e-8d34-ec978d9581ae  /data  xfs  defaults,nofail  0  2
```

* data : sdb에 저장
* umount 해지 : 폴더 안의 data 보이지 않음
* Block Storage : 
  * sda (root volume) - OS 탑재, App 



## 4. SAMBA (Server Message Block; 윈도우용 파일 공유 시스템) - Amazon FSx  - 완전 관리형 서비스

* 서버 메시지 블록(Server Message Block, SMB)은 도스나 윈도우에서 파일이나 디렉터리 및 주변 장치들을 공유하는데 사용되는 메시지 형식입니다. 
* NetBIOS는 SMB 형식에 기반을 두고 있으며, 많은 네트워크 제품들도 SMB를 사용합니다. 
* 이러한 SMB 기반의 네트워크에는 랜매니저, 윈도우 포 워크그룹(Windows for Workgroups), 윈도우 NT, 그리고 랜 서버(Lan Server) 등이 있습니다. 
* 서로 다른 운영 체제 사이에 파일을 공유할 수 있도록 하기 위해 SMB를 사용하는 제품들도 많이 있습니다. 
* 그 중 하나가 삼바(SAMBA)인데, 유닉스와 윈도우 컴퓨터들간에 디렉터리와 파일을 공유할 수 있게 합니다.

```
# yum install -y samba
# mkdir -p /var/samba/share
# chmod 777 /var/samba/share
# adduser kosa
# passwd kosa
# smbpasswd -a kosa
# vi /etc/samba/smb.conf
```

```
        workgroup = hali
[share]
        comment = Share Directory
        path = /var/samba/share
        browserable = yes
        writable = yes
        valid users = johnlee
        create mask = 0777
        directory mask = 0777
```

```
# systemctl start smb
# systemctl start nmb
\\192.168.0.69
# firewall-cmd --permanent --add-service=samba --zone=public
# firewall-cmd --reload
```

* 윈도우 클라이언트 접속 방법

```
\\192.168.56.101
```

*  CentOS7 클라이언트 접속 방법

```
# yum install -y samba-client
# smbclient //192.168.56.101/share -U kosa
```





-------- 복습

## 5. NFS (Network File System; 리눅스용 파일 공유 시스템) - AWS EFS - 완전 관리형 서비스

* 네트워크 파일 시스템(Network File System, NFS)은 1984년에 썬 마이크로시스템즈가 개발한 프로토콜입니다. 
* 클라이언트 컴퓨터의 사용자가 네트워크 상의 파일을 직접 연결된 스토리지에 접근하는 방식과 비슷한 방식으로 접근하도록 도와 줍니다. 
* 다른 수많은 프로토콜과 마찬가지로 ONC RPC 시스템을 기반으로 합니다. 
* 네트워크 파일 시스템은 RFC에 정의된 오픈 표준이므로 누구나 구현할 수 있습니다.



**프로토콜**

* 이기종간 통신(윈도우-리눅스)을 위한 규약

* 객체 스토리지 (Object Storage)
  * 현재 WebShare : http 프로토콜 사용
    * 웹서버 기능 탑재
  * SAMBA : NetBIOS 프로토콜 사용 
  * NFS : NFS 자체가 프로토콜



**ip 범위**

* `192.168.56.0/24`
  * `192.168.56` : 네트워크 영역
  * `0/24` : 호스트 영역
* ip 갯수가 256개 - 2개 = 실제 사용 가능 IP 254개
  * `192.168.56.0` : 네트워크 주소 (시작하는 ip)
  * `192.168.56.255` : 브로드캐스트 주소 (마지막 ip)



#### XFCE

> 192.168.56.101

* 서버

```
# yum install -y nfs-utils
# mkdir /share && cd $_
# echo "Hello" > test.txt
# chmod o+w test.txt

# vi /etc/exports
/share 192.168.56.0/24(rw,sync)
```

```
# chmod 707 /share
# systemctl start nfs-server
# systemctl enable nfs-server

# systemctl enable --now nfs-server
Created symlink from /etc/systemd/system/multi-user.target.wants/nfs-server.service to /usr/lib/systemd/system/nfs-server.service.

# exportfs -v
/share        	192.168.56.0/24(sync,wdelay,hide,no_subtree_check,sec=sys,rw,secure,root_squash,no_all_squash)
```

* 방화벽 처리
  * firewalld 서비스가 동작 중이라면 NFS 서버 서비스에 필요한 포트들 (mountd, nfs, rpc-bind)을 열어 주어야 한다.

```
# firewall-cmd --permanent --add-service=nfs
# firewall-cmd --permanent --add-service=rpc-bind
# firewall-cmd --permanent --add-service=mountd
# firewall-cmd --reload
```







#### Minimal

> 192.168.56.120

* 클라이언트
  * `rpm -qa` : 현재 VM에 설치되어있는 App

```
# rpm -qa | grep nfs-utils
# yum install -y nfs-utils

# showmount -e 192.168.56.101
Export list for 192.168.56.101:                                                             /share 192.168.56.0/24 

# mkdir share
# mount -t nfs 192.168.56.101:/share /root/share

# df -h
192.168.56.101:/share    124G  3.3G  120G   3% /root/share  

# echo "OK" >> /root/share/test.txt                                       
# cat /root/share/test.txt
Hello                                
OK  

# vi /etc/sysconfig/selinux
SELINUX=disabled

# vi /etc/fstab
192.168.0.69:/share /root/share nfs defaults 0 0
```

* mount를 통해 XFCE의 share 폴더 공유

------------------------------ 점심

##  DB서버(Database Management System; MariaDB)
* MariaDB는 오픈 소스의 관계형 데이터베이스 관리 시스템(RDBMS)입니다. 
* MySQL과 동일한 소스 코드를 기반으로 하며, GPL v2 라이선스를 따릅니다. 
* 오라클 소유의 현재 불확실한 MySQL의 라이선스 상태에 반발하여 만들어졌습니다.



###

```
# vi /etc/yum.repos.d/MariaDB.repo
[mariadb]
name = MariaDB
baseurl = http://yum.mariadb.org/10.4/centos7-amd64
gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
gpgcheck=1
```



```
# yum install -y MariaDB
# rpm -qa | grep MariaDB
# mariadb --version

# systemctl start mariadb
# systemctl enable mariadb
# systemctl enable --now mariadb


# mysql_secure_installation
# systemctl restart mariadb
# mysql -u root -p
```















