# 0729

* CI /CD 흐름

![image-20220729092044040](md-images/0729/image-20220729092044040.png)

- CI : git - maven
- CD : jenkins - tomcat 



## GitLab

### Create new project

![image-20220729093230253](md-images/0729/image-20220729093230253.png)



### 원격 저장소 마이그레이션

> Github에서 Gitlab으로..

* `github` migration

```
$ mkdir git-migration
$ git clone --mirror https://github.com/xeomina/hello-world.git git-migration
$ cd git-migration/
$ ls
```

![image-20220729094041151](md-images/0729/image-20220729094041151.png)

* branch 생성
  * master

![image-20220729094106507](md-images/0729/image-20220729094106507.png)

![image-20220729094127530](md-images/0729/image-20220729094127530.png)

![image-20220729094238896](md-images/0729/image-20220729094238896.png)

![image-20220729094331076](md-images/0729/image-20220729094331076.png)

* clone

```
http://gitlab.xeomina.shop/xeomina/dev-site.git
```

![image-20220729094405251](md-images/0729/image-20220729094405251.png)

* push

```
$ git push -uf http://gitlab.xeomina.shop/xeomina/dev-site --all
```

![image-20220729094537314](md-images/0729/image-20220729094537314.png)

![image-20220729094609226](md-images/0729/image-20220729094609226.png)



## Jenkins

### AWS EC2 인스턴스 생성

* `jenkins-server`
* 사용자 데이터

```
#! /bin/bash
timedatectl set-timezone Asia/Seoul
```



### Jenkins 설치

*  jenkins 저장소 추가

```
$ sudo su -		# root 계정으로
# wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo
```

* key 추가

````
# rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key
````

* `java` 및 `fontconfig` 설치
  * AL2에는 `java-11-openjdk` 대신 `java-openjdk11` 설치

```
# yum install -y fontconfig java-11-openjdk
# amazon-linux-extras install -y java-openjdk11
```

![image-20220729100926644](md-images/0729/image-20220729100926644.png)

* `git` 설치

```
# hostnamectl set-hostname jenkins-server
# yum install -y git
```

* `jenkins` 설치

```
# yum install -y jenkins
# systemctl enable --now jenkins
# cat /var/lib/jenkins/secrets/initialAdminPassword
0134779d86c740bdb50cc9ee123dbc4b
```

* 포트번호 확인
  * 8080

```
# ss -nat
```

![image-20220729101937004](md-images/0729/image-20220729101937004.png)



### Jenkins 접속

* `jenkins.xeomina.shop:8080`

![image-20220729102209878](md-images/0729/image-20220729102209878.png)

* x 클릭

![image-20220729102220664](md-images/0729/image-20220729102220664.png)

* Start Jenkins

![image-20220729102232479](md-images/0729/image-20220729102232479.png)

* password 변경 및 timezone 설정

![image-20220729102330677](md-images/0729/image-20220729102330677.png)

* Apply > Save

![image-20220729102344887](md-images/0729/image-20220729102344887.png)

* 다시 로그인

![image-20220729102417769](md-images/0729/image-20220729102417769.png)



### Create Project

* `HelloWorldJob`
  * 플러그인 설치 전에는 `Freestyle project` ..


![image-20220729102730947](md-images/0729/image-20220729102730947.png)

![image-20220729103108366](md-images/0729/image-20220729103108366.png)

![image-20220729103123472](md-images/0729/image-20220729103123472.png)

* Build

![image-20220729103159816](md-images/0729/image-20220729103159816.png)

![image-20220729103207977](md-images/0729/image-20220729103207977.png)

###  Plugin

* `GitLab` 플러그인 설치

![image-20220729103623470](md-images/0729/image-20220729103623470.png)

![image-20220729103813964](md-images/0729/image-20220729103813964.png)

* Global Tool Configuration

![image-20220729104255548](md-images/0729/image-20220729104255548.png)

![image-20220729104452044](md-images/0729/image-20220729104452044.png)

### Create Project

* `PullCodeFromGitLab`

![image-20220729104714556](md-images/0729/image-20220729104714556.png)

![image-20220729104801700](md-images/0729/image-20220729104801700.png)

* 소스 코드 관리

```
http://gitlab.xeomina.shop/xeomina/dev-site.git
```

![image-20220729104913021](md-images/0729/image-20220729104913021.png)

![image-20220729105222230](md-images/0729/image-20220729105222230.png)

* Build

![image-20220729105252083](md-images/0729/image-20220729105252083.png)

![image-20220729105330381](md-images/0729/image-20220729105330381.png)

* 연결 확인

```
# cd /var/lib/jenkins/workspace/PullCodeFromGitLab/
# ll
```

![image-20220729110352946](md-images/0729/image-20220729110352946.png)



## Maven

### Maven 설치

* `-xvzf` : extrack view zip file

```
# cd /opt
# wget https://dlcdn.apache.org/maven/maven-3/3.8.6/binaries/apache-maven-3.8.6-bin.tar.gz
# tar -xvzf apache-maven-3.8.6-bin.tar.gz
```

* `mvn` : 실행 파일

```
# mv apache-maven-3.8.6 maven	# 이름 바꾸기
# ls maven/bin/
```

![image-20220729111157658](md-images/0729/image-20220729111157658.png)

### 경로 설정

* JAVA 찾기

```
# find / -name java-11*
```

![image-20220729111429409](md-images/0729/image-20220729111429409.png)

* 환경변수 설정
  * `jenkins`가 어디서든 `maven` 실행 가능하도록

```
# vi .bash_profile
# .bash_profile

# Get the aliases and functions
if [ -f ~/.bashrc ]; then
        . ~/.bashrc
fi

M2_HOME=/opt/maven
M2=/opt/maven/bin
JAVA_HOME=/usr/lib/jvm/java-11-openjdk-11.0.13.0.8-1.amzn2.0.3.x86_64

# User specific environment and startup programs

PATH=$PATH:$HOME/bin:$JAVA_HOME:$M2_HOME:$M2

export PATH
```

![image-20220729111656600](md-images/0729/image-20220729111656600.png)

* 경로 적용 및 확인

```
# source .bash_profile
# echo $PATH
# mvn -v
```

![image-20220729112039623](md-images/0729/image-20220729112039623.png)



### Plugin

* Plugin Manager

![image-20220729112538288](md-images/0729/image-20220729112538288.png)



### Global Tool Configuration

* JDK
  * `java-11`
  * Install Automaticaly 체크 해제
  * JAVA_HOME=`/usr/lib/jvm/java-11-openjdk-11.0.13.0.8-1.amzn2.0.3.x86_64`

![image-20220729113103560](md-images/0729/image-20220729113103560.png)

* Maven 
  * `maven-3.8.6`
  * Install Automaticaly 체크 해제
  * MAVEN_HOME : `/opt/maven`

![image-20220729113217304](md-images/0729/image-20220729113217304.png)



### Create Project

* `FirstMavenProject`
  * Maven Project

![image-20220729113449260](md-images/0729/image-20220729113449260.png)

![image-20220729113906038](md-images/0729/image-20220729113906038.png)

![image-20220729113916274](md-images/0729/image-20220729113916274.png)

![image-20220729113934678](md-images/0729/image-20220729113934678.png)

* 빌드 확인

![image-20220729114128974](md-images/0729/image-20220729114128974.png)

* 워크스페이스 확인

```
# cd /var/lib/jenkins/workspace/FirstMavenProject
# ll
```

![image-20220729114244583](md-images/0729/image-20220729114244583.png)