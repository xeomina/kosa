# 0502

## 프로젝트 개요

- 실무 기초 : 인프라 [운영체제(리눅스, 윈도우), 서버(WEB, DNS, DB, SAMBA, NFS), 네트워크(NAT; 라우터, DHCP; IP 자동부여, HAProxy; L4, L7 S/W)]

- 실무 심화 : 가상화 [하이퍼바이저 타입 1 (ESXi)], 프라이빗 클라우드 [Openstack], 언어 [파이썬, 고언어], 퍼블릭 클라우드 [AWS, Azure, GCP, Alibaba], 클라우드 보안

- 실무 특화 : 자동화도구 [Terraform, Ansible], 컨테이너 기술 [Docker, Kubernetes], CI/CD [Jenkins, Gitlab, AWS CodeCommit, CodeBulid], CodePipeline]

- 2차 세미 프로젝트 과제명 : 프라이빗 클라우드(ESXi, Openstack)와 퍼블릭 클라우드(AWS, Azure, GCP, Alibaba)를 융복합한 멀티클라우드 설계 및 구축

- 최종 프로젝트 과제명 : 애자일 개발 환경을 위한  DevOps CI/CD 파이프라인 자동화 프로젝트




### 망도

* 물리랜카드 - 업링크

![image-20220502101716502](md-images/0502/image-20220502101716502.png)



### Moba - key 접속

```
> cd .ssh
> ssh-copy-id -i id_rsa.pub root@192.168.0.43
```

![image-20220502102829609](md-images/0502/image-20220502102829609.png)

```
#  hostnamectl set-hostname nat
```



## 1. Router 

* IP 공유기; AWS VPC NAT GateWay

### ip 고정

```
# vi /etc/sysconfig/network-scripts/ifcfg-ens192
TYPE=Ethernet
BOOTPROTO=none
NAME=ens192
DEVICE=ens192
ONBOOT=yes
IPADDR=192.168.0.43
NETMASK=255.255.255.0
GATEWAY=192.168.0.1
DNS1=8.8.8.8
DNS2=8.8.4.4
```

```
# vi /etc/sysconfig/network-scripts/ifcfg-ens224
TYPE=Ethernet
BOOTPROTO=none
NAME=ens224
DEVICE=ens224
ONBOOT=yes
IPADDR=10.0.23.1
NETMASK=255.255.255.0
```

```
# systemctl restart network
```



### 자동완성

```
# yum install -y bash-completion
```



### 랜카드 존 설정

```
# nmcli c mod ens192 connection.zone external
# nmcli c mod ens224 connection.zone internal
# firewall-cmd --get-active-zone
```



### ip 포워드

```
# sysctl -w net.ipv4.ip_forward=1 # 리눅스 시스템을 라우터로 만드는 셋팅
# sysctl -p # 설정 저장
# cat /proc/sys/net/ipv4/ip_forward
1
```



## 2. DHCP

* 동적 호스트 구성 프로토콜(Dynamic Host Configuration Protocol)

### dhcp 설치

```
# yum install dhcp -y
```

### dhcpd.conf 파일 설정

```
# vi /etc/dhcp/dhcpd.conf
ddns-update-style interim;
subnet 10.0.23.0 netmask 255.255.255.0 {
option routers 10.0.23.1;
option subnet-mask 255.255.255.0;
range dynamic-bootp 10.0.23.2 10.0.23.254;
option domain-name-servers 10.0.23.1, 8.8.8.8, 203.248.252.2;
default-lease-time 7200;
max-lease-time 86400;
}
```

### start & enable

```
# systemctl enable --now dhcpd
```

### ip 확인

- WEB01 : 10.0.23.3
- WEB02 : 10.0.23.2
- WEB03 : 10.0.23.5
- DB : 10.0.23.4

### 포트포워딩

* WEB01 : 192.168.0.43:221 > 10.0.23.3:22
* WEB02 : 192.168.0.43:222 > 10.0.23.2:22
* DB : 192.168.0.43:223 > 10.0.23.4:22

```
# firewall-cmd --permanent --zone=external --add-forward-port=port=221:proto=tcp:toport=22:toaddr=10.0.23.3
# firewall-cmd --permanent --zone=external --add-forward-port=port=222:proto=tcp:toport=22:toaddr=10.0.23.2
# firewall-cmd --permanent --zone=external --add-forward-port=port=223:proto=tcp:toport=22:toaddr=10.0.23.4
# firewall-cmd --permanent --zone=external --add-forward-port=port=3306:proto=tcp:toport=3306:toaddr=10.0.23.4		#unknown port 외부 3306 > 내부 3306	- mariadb
# firewall-cmd --permanent --zone=external --add-forward-port=port=3389:proto=tcp:toport=3389:toaddr=10.0.23.5		#unknown port 외부 3389 > 내부 3389 - rdp

# firewall-cmd --reload
```



### 포트 확인

```
# firewall-cmd --list-all --zone=external
  forward-ports: port=221:proto=tcp:toport=22:toaddr=10.0.23.3
        port=222:proto=tcp:toport=22:toaddr=10.0.23.2
        port=223:proto=tcp:toport=22:toaddr=10.0.23.4
        port=3389:proto=tcp:toport=3389:toaddr=10.0.23.5
        port=3306:proto=tcp:toport=3306:toaddr=10.0.23.4
  source-ports:
```



### key 복사

```
ssh-copy-id -p 221 -i id_rsa.pub root@192.168.0.43
ssh-copy-id -p 222 -i id_rsa.pub xeomina@192.168.0.43
ssh-copy-id -p 223 -i id_rsa.pub root@192.168.0.43
```



### WEB01 서버

![image-20220502120606176](md-images/0502/image-20220502120606176.png)

```
#  hostnamectl set-hostname web01
```



### WEB02 서버

![image-20220502120933719](md-images/0502/image-20220502120933719.png)

```
$ sudo hostnamectl set-hostname web02
```



### DB 서버

![image-20220502121106769](md-images/0502/image-20220502121106769.png)

```
# hostnamectl set-hostname db
```



### WEB03 서버

* 원격 접속 허용

![image-20220502125044837](md-images/0502/image-20220502125044837.png)

![image-20220502124434245](md-images/0502/image-20220502124434245.png)

![image-20220502122502568](md-images/0502/image-20220502122502568.png)

* RDP(Remote Desktop Protocol) 3380 port 방화벽 설정

![image-20220502123159288](md-images/0502/image-20220502123159288.png)

![image-20220502123344920](md-images/0502/image-20220502123344920.png)

![image-20220502123406396](md-images/0502/image-20220502123406396.png)

![image-20220502123507153](md-images/0502/image-20220502123507153.png)

* HTTP(Hyper Text Transfer Protocol) 80 port 방화벽 설정

![image-20220502123819245](md-images/0502/image-20220502123819245.png)

![image-20220502123839929](md-images/0502/image-20220502123839929.png)

* RDP

![image-20220502122915515](md-images/0502/image-20220502122915515.png)