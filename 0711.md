# 0711

# Docker

## 컨테이너 / 이미지 목록 및 삭제

* 컨테이너 목록

```
# docker ps
```

![image-20220711101146499](md-images/0711/image-20220711101146499.png)

* 컨테이너 한번에 삭제
  * `ps` : list
  * `-a` : all
  * `-q` : id

```
# docker rm -f $(docker ps -a -q)
```

![image-20220711101355417](md-images/0711/image-20220711101355417.png)

* 이미지 목록

```
# docker images
```

* 이미지 한번에 삭제

```
# docker rmi $(docker images -q)
```

![image-20220711102243020](md-images/0711/image-20220711102243020.png)



## 컨테이너 생성 및 시작

* ceontos7 버전으로 `test_cal` 생성
  * 한번 실행하고 멈춤

```
# docker run --name test_cal centos:7 /bin/cal
```

![image-20220711102826020](md-images/0711/image-20220711102826020.png)

* 컨테이너 바로 삭제
  * `-rm`

```
# docker run --name test_cal1 --rm centos:7 /bin/cal
```

![image-20220711102927519](md-images/0711/image-20220711102927519.png)



##  터미널과 컨테이너 연결

* `-it``
* ``-i` : 표준 입력
  * 안붙이면 명령어 x

![image-20220711103224960](md-images/0711/image-20220711103224960.png)

* `-t` : 터미널
  * 안붙이면 prompt x

![image-20220711103603911](md-images/0711/image-20220711103603911.png)



## 백그라운드 실행

* `-d`
  * `logs`로 확인

```
# docker run -d --name test_ping centos:7 /bin/ping localhost
# docker ps
# docker logs -t test_ping
```

![image-20220711104030683](md-images/0711/image-20220711104030683.png)



## 접속 포트 설정

```
# docker run -d -p 8080:80 test_port nginx
# docker ps
```

![image-20220711105654945](md-images/0711/image-20220711105654945.png)

![image-20220711105800839](md-images/0711/image-20220711105800839.png)

* 리소스 확인

```
# docker stats test_prot
```

![image-20220711111046088](md-images/0711/image-20220711111046088.png)



## 리소스 지정

```
# docker run -d -p 8181:80 --cpus 1 --memory=256m --name test_resource nginx
# docker ps
```

![image-20220711111311005](md-images/0711/image-20220711111311005.png)

```
# docker stats test_resource
```

![image-20220711112445532](md-images/0711/image-20220711112445532.png)

![image-20220711111902334](md-images/0711/image-20220711111902334.png)



## 디렉토리 공유

```
# docker run -d -p 8282:80 --cpus 1 --memory 512m -v /tmp:/usr/share/nginx/html --name volume-container nginx
# docker ps
```

![image-20220711111630127](md-images/0711/image-20220711111630127.png)

![image-20220711111834986](md-images/0711/image-20220711111834986.png)

## 컨테이너 리스트

```
# docker ps -a --format "table {{.Command}}\t{{.Ports}}"
```

![image-20220711111740195](md-images/0711/image-20220711111740195.png)

```
# docker ps -a -f name=test_
```

![image-20220711112337115](md-images/0711/image-20220711112337115.png)



## 동작중인 컨테이너 프로세스 실행

* `exec`

```
# docker exec -it test_bash /bin/bash
```

![image-20220711112846007](md-images/0711/image-20220711112846007.png)



## 이름 변경

```
# docker rename test_port webserver
```

![image-20220711113122760](md-images/0711/image-20220711113122760.png)



## 컨테이너 안의 파일 복사

*

```
# docker cp webserver:/usr/share/nginx/html/index.html /root/index.html
# vi /root/index.html
```

![image-20220711113419329](md-images/0711/image-20220711113419329.png)

* 다시 복사

```
# docker cp ./index.html webserver:/usr/share/nginx/html/index.html
```

![image-20220711113615173](md-images/0711/image-20220711113615173.png)

![image-20220711113646447](md-images/0711/image-20220711113646447.png)



## 컨테이너와 원본 이미지의 차이점 확인

```
# docker diff webserver
```

![image-20220711113928511](md-images/0711/image-20220711113928511.png)



## tar 압축파일 풀기

```
# pwd
# ls
# tar -xvf food.tar -C html
# ls html/
# docker cp ./html webserver:/usr/share/nginx
```



## 컨테이너를 이미지로 만들기

```
# docker commit -a "xeomina<test@example.com>" -m "FOOD" webserver test_commit:v1.0
```

![image-20220711115037226](md-images/0711/image-20220711115037226.png)

## 이미지 저장

```
# docker save -o test_commit.tar test_commit:v1.0
```

* tar 파일은 사이즈가 줄지 않는다

![image-20220711120619891](md-images/0711/image-20220711120619891.png)

## 

# Docker 네트워크 구조

![docker-network](md-images/0711/_docker-network.png)

* 2개의 컨테이너 > docker 0와 연결 = 공유기 (NAT GW의 기능)

  

* IP 확인

```
# ip a
```

![image-20220711140248189](md-images/0711/image-20220711140248189.png)

```
# docker exec -it test_bash /bin/bash
# yum install -y iproute
# ip a
```

![image-20220711140846621](md-images/0711/image-20220711140846621.png)



## 네트워크 리스트 표시

* 기본 구문

```
# docker network ls [옵션]
```

* 옵션

| 옵션            | 설명                   |
| --------------- | ---------------------- |
| -f, --filter=[] | 필터링하여 출력한다    |
| --no-trunc      | 모든 정보를 출력한다   |
| -q, --quiet     | 네트워크 ID만 출력한다 |



* 사용예시

```
# docker network ls
# docker network ls -q --filter driver=bridge
```

![image-20220711141432930](md-images/0711/image-20220711141432930.png)



* `bridge` 네트워크 정보
  * `docker0` 
  * container 5개

```
# docker inspect bridge
```

![image-20220711141313083](md-images/0711/image-20220711141313083.png)

![image-20220711141335521](md-images/0711/image-20220711141335521.png)



## 네트워크 생성 및 삭제

* 기본 구문

```
# docker network create
```

* 옵션

| 옵션         | 설명                                   |
| ------------ | -------------------------------------- |
| --driver, -d | 네트워크 브리지 또는 오버레이          |
| --ip-range   | 컨테이너에 할당하는 IP주소의 범위 지정 |
| --subnet     | 서브넷을   CIDR 형식으로 지정          |

* 사용 예시

```
# docker network create -d bridge --subnet 192.168.123.0/24 --ip-range 192.168.123.128/25 test_bridge
# docker network ls
```

![image-20220711142018820](md-images/0711/image-20220711142018820.png)

* `webserver2` 컨테이너 생성
  * 네트워크 : `test_bridge`
  * 이미지 : `nginx`

```
# docker run -d -p 8383:80 --name webserver2 --network test_bridge nginx
```

![image-20220711142429335](md-images/0711/image-20220711142429335.png)



* ip 확인
  * test_brigde :  `br-78ca716bd5ac`
    * G/W IP :  192.168.123.128
  * `44: veth8511c23@if43` : container 안쪽의 인터페이스
    * `if43` : test_bridge의 인터페이스 포트번호

```
# ip a
```

![image-20220711142730011](md-images/0711/image-20220711142730011.png)

## 네트워크 연결

* 기본 구문

```
# docker network connect [옵션] 네트워크 컨테이너
```

* 사용 예시
* `test_bash` 컨테이너 네트워크 확인

````
# docker inspect test_bash
````

![image-20220711143236667](md-images/0711/image-20220711143236667.png)

* `test_bash` 컨테이너에 `test_bridge` 네트워크 연결

```
# docker network connect test_bridge test_bash
# docker inspect test_bash
```

![image-20220711143429011](md-images/0711/image-20220711143429011.png)

* `test_bash` 컨테이너에서 `bridge` 네트워크 연결 끊기

```
# docker network disconnect bridge test_bash
# docker inspect test_bash
```

![image-20220711143457724](md-images/0711/image-20220711143457724.png)

* `test_bridge`에 연결된 컨테이너 확인

```
# docker inspect test_bridge
```

![image-20220711143553956](md-images/0711/image-20220711143553956.png)

* 내부적으로 같은 도커 (test_bridge) 안에서는 ip가 아닌 컨테이너 이름을 도메인처럼 사용 가능
  * ip 바뀌어도 링크 유지

```
# docker exec -it test_bash /bin/bash
# ping webserver2
```

![image-20220711143753609](md-images/0711/image-20220711143753609.png)

```
# cat /etc/hosts
```

![image-20220711143900416](md-images/0711/image-20220711143900416.png)



# 워드프레스

## dbserver 생성

* `-e` : 환경 변수 정의

```
- dbserver
# docker run -d -p 3306:3306 --name dbserver \
-e MYSQL_DATABASE=wordpress \
-e MYSQL_USER=wpuser \
-e MYSQL_PASSWORD=wppass \
-e MYSQL_ROOT_PASSWORD=password --network test_bridge mariadb
```

![image-20220711150820204](md-images/0711/image-20220711150820204.png)

## webserver 생성

* apache 설치

```
- webserver
# docker run -itd -p 8888:80 --name apache --network test_bridge centos:7
# docker exec -it apache bash
# yum install -y httpd php php-mysql php-gd php-mbstring wget unzip
# wget https://ko.wordpress.org/wordpress-4.8.2-ko_KR.zip
# cd /var/www/html
# unzip /wordpress-4.8.2-ko_KR.zip
# mv wordpress/* .
# chown -R apache:apache /var/www
# httpd &
httpd
```

![image-20220711152301397](md-images/0711/image-20220711152301397.png)

![image-20220711153125475](md-images/0711/image-20220711153125475.png)

![image-20220711153424058](md-images/0711/image-20220711153424058.png)



* wordpress 접속
  * 192.168.1.83:8888

![image-20220711153320723](md-images/0711/image-20220711153320723.png)

* 데이터베이스 호스트 : dbserver 

![image-20220711153354950](md-images/0711/image-20220711153354950.png)